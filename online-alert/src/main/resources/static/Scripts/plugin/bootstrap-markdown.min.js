/* SmartAdmin - v1.4.1 - 2014-06-26 */
!function(f){var g=function(a,d){this.$ns="bootstrap-markdown",this.$element=f(a),this.$editable={el:null,type:null,attrKeys:[],attrValues:[],content:null},this.$options=f.extend(!0,{},f.fn.markdown.defaults,d),this.$oldContent=null,this.$isPreview=!1,this.$editor=null,this.$textarea=null,this.$handler=[],this.$callback=[],this.$nextTab=[],this.showEditor()};g.prototype={constructor:g,__alterButtons:function(a,k){var l=this.$handler,m="all"==a,n=this;f.each(l,function(b,c){var e=!0;e=m?!1:c.indexOf(a)<0,0==e&&k(n.$editor.find('button[data-handler="'+c+'"]'))})},__buildButtons:function(a,s){var t,u=this.$ns,v=this.$handler,w=this.$callback;for(t=0;t<a.length;t++){var x,y=a[t];for(x=0;x<y.length;x++){var z,A=y[x].data,B=f("<div/>",{"class":"btn-group"});for(z=0;z<A.length;z++){var C=A[z],D="",E=u+"-"+C.name,F=C.btnText?C.btnText:"",G=C.btnClass?C.btnClass:"btn",H=C.tabIndex?C.tabIndex:"-1";1==C.toggle&&(D=' data-toggle="button"'),B.append('<button class="'+G+' btn-default btn-sm" title="'+C.title+'" tabindex="'+H+'" data-provider="'+u+'" data-handler="'+E+'"'+D+'><span class="'+C.icon+'"></span> '+F+"</button>"),v.push(E),w.push(C.callback)}s.append(B)}}return s},__setListener:function(){var a="undefined"!=typeof this.$textarea.attr("rows"),e=this.$textarea.val().split("\n").length>5?this.$textarea.val().split("\n").length:"5",k=a?this.$textarea.attr("rows"):e;this.$textarea.attr("rows",k),this.$textarea.css("resize","none"),this.$textarea.on("focus",f.proxy(this.focus,this)).on("keypress",f.proxy(this.keypress,this)).on("keyup",f.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$textarea.on("keydown",f.proxy(this.keydown,this)),this.$textarea.data("markdown",this)},__handle:function(a){var k=f(a.currentTarget),l=this.$handler,m=this.$callback,n=k.attr("data-handler"),o=l.indexOf(n),p=m[o];f(a.currentTarget).focus(),p(this),n.indexOf("cmdSave")<0&&this.$textarea.focus(),a.preventDefault()},showEditor:function(){var a,p=this,q=this.$ns,r=this.$element,s=(r.css("height"),r.css("width"),this.$editable),t=this.$handler,u=this.$callback,v=this.$options,w=f("<div/>",{"class":"md-editor",click:function(){p.focus()}});if(null==this.$editor){var x=f("<div/>",{"class":"md-header btn-toolbar"});v.buttons.length>0&&(x=this.__buildButtons(v.buttons,x)),v.additionalButtons.length>0&&(x=this.__buildButtons(v.additionalButtons,x)),w.append(x);if(r.is("textarea")){r.before(w),a=r,a.addClass("md-input"),w.append(a)}else{var y="function"==typeof toMarkdown?toMarkdown(r.html()):r.html(),z=f.trim(y);a=f("<textarea/>",{"class":"md-input",val:z}),w.append(a),s.el=r,s.type=r.prop("tagName").toLowerCase(),s.content=r.html(),f(r[0].attributes).each(function(){s.attrKeys.push(this.nodeName),s.attrValues.push(this.nodeValue)}),r.replaceWith(w)}if(v.savable){var A=f("<div/>",{"class":"md-footer"}),B="cmdSave";t.push(B),u.push(v.onSave),A.append('<button class="btn btn-success" data-provider="'+q+'" data-handler="'+B+'"><i class="fa fa-check"></i> Save</button>'),w.append(A)}f.each(["height","width"],function(c,d){"inherit"!=v[d]&&(jQuery.isNumeric(v[d])?w.css(d,v[d]+"px"):w.addClass(v[d]))}),this.$editor=w,this.$textarea=a,this.$editable=s,this.$oldContent=this.getContent(),this.__setListener(),this.$editor.attr("id",(new Date).getTime()),this.$editor.on("click",'[data-provider="bootstrap-markdown"]',f.proxy(this.__handle,this))}else{this.$editor.show()}v.autofocus&&(this.$textarea.focus(),this.$editor.addClass("active"));v.onShow(this);return this},showPreview:function(){var a,k=this.$options,l=k.onPreview(this),m=this.$textarea,n=m.next(),o=f("<div/>",{"class":"md-preview","data-provider":"markdown-preview"});this.$isPreview=!0;this.disableButtons("all").enableButtons("cmdPreview");a="string"==typeof l?l:"object"==typeof markdown?markdown.toHTML(m.val()):m.val();o.html(a);n&&"md-footer"==n.attr("class")?o.insertBefore(n):m.parent().append(o);m.hide();o.data("markdown",this);return this},hidePreview:function(){this.$isPreview=!1;var b=this.$editor.find('div[data-provider="markdown-preview"]');return b.remove(),this.enableButtons("all"),this.$textarea.show(),this.__setListener(),this},isDirty:function(){return this.$oldContent!=this.getContent()},getContent:function(){return this.$textarea.val()},setContent:function(b){return this.$textarea.val(b),this},findSelection:function(k){var l,m=this.getContent();if(l=m.indexOf(k),l>=0&&k.length>0){var n,o=this.getSelection();this.setSelection(l,l+k.length),n=this.getSelection(),this.setSelection(o.start,o.end);return n}return null},getSelection:function(){var b=this.$textarea[0];var c=null;if("selectionStart" in b){c=function(){var a=b.selectionEnd-b.selectionStart;return{start:b.selectionStart,end:b.selectionEnd,length:a,text:b.value.substr(b.selectionStart,a)}}}else{c=function(){return null}}return c()},setSelection:function(d,e){var k=this.$textarea[0];return("selectionStart" in k&&function(){k.selectionStart=d,k.selectionEnd=e}||function(){return null})()},replaceSelection:function(c){var d=this.$textarea[0];var e=null;if("selectionStart" in d){e=function(){d.value=d.value.substr(0,d.selectionStart)+c+d.value.substr(d.selectionEnd,d.value.length);d.selectionStart=d.value.length;return this}}else{e=function(){d.value+=c;return jQuery(d)}}return e()},getNextTab:function(){if(0==this.$nextTab.length){return null}var c,d=this.$nextTab.shift();"function"==typeof d?c=d():"object"==typeof d&&d.length>0&&(c=d);return c},setNextTab:function(e,k){if("string"==typeof e){var l=this;this.$nextTab.push(function(){return l.findSelection(e)})}else{if("numeric"==typeof e&&"numeric"==typeof k){var m=this.getSelection();this.setSelection(e,k),this.$nextTab.push(this.getSelection()),this.setSelection(m.start,m.end)}}},enableButtons:function(c){var d=function(b){b.removeAttr("disabled")};return this.__alterButtons(c,d),this},disableButtons:function(c){var d=function(b){b.attr("disabled","disabled")};return this.__alterButtons(c,d),this},eventSupported:function(c){var d=c in this.$element;return d||(this.$element.setAttribute(c,"return;"),d="function"==typeof this.$element[c]),d},keydown:function(a){this.suppressKeyPressRepeat=~f.inArray(a.keyCode,[40,38,9,13,27]),this.keyup(a)},keypress:function(b){this.suppressKeyPressRepeat||this.keyup(b)},keyup:function(k){var l=!1;switch(k.keyCode){case 40:case 38:case 16:case 17:case 18:break;case 9:var m=this.getNextTab();if(null!=m){var n=this;setTimeout(function(){n.setSelection(m.start,m.end)},500);l=!0}else{var o=this.getSelection();if(o.start==o.end&&o.end==this.getContent().length){l=!1}else{this.setSelection(this.getContent().length,this.getContent().length),l=!0}}break;case 13:case 27:l=!1;break;default:l=!1}l&&(k.stopPropagation(),k.preventDefault())},focus:function(){var a=this.$options,d=(a.hideable,this.$editor);d.addClass("active"),f(document).find(".md-editor").each(function(){if(f(this).attr("id")!=d.attr("id")){var c=f(this).find("textarea").data("markdown");null==c&&(c=f(this).find('div[data-provider="markdown-preview"]').data("markdown")),c&&c.blur()}});return this},blur:function(){var a=this.$options,k=a.hideable,l=this.$editor,m=this.$editable;if(l.hasClass("active")||0==this.$element.parent().length){if(l.removeClass("active"),k){if(null!=m.el){var n=f("<"+m.type+"/>"),o=this.getContent(),p="object"==typeof markdown?markdown.toHTML(o):o;f(m.attrKeys).each(function(b){n.attr(m.attrKeys[b],m.attrValues[b])}),n.html(p),l.replaceWith(n)}else{l.hide()}}a.onBlur(this)}return this}};var h=f.fn.markdown;f.fn.markdown=function(a){return this.each(function(){var b=f(this),c=b.data("markdown"),k="object"==typeof a&&a;c||b.data("markdown",c=new g(this,k))})},f.fn.markdown.defaults={autofocus:!1,hideable:!1,savable:!1,width:"inherit",height:"inherit",buttons:[[{name:"groupFont",data:[{name:"cmdBold",title:"Bold",icon:"glyphicon glyphicon-bold",callback:function(k){var l,m,n=k.getSelection(),o=k.getContent();l=0==n.length?"strong text":n.text;if("**"==o.substr(n.start-2,2)&&"**"==o.substr(n.end,2)){k.setSelection(n.start-2,n.end+2),k.replaceSelection(l),m=n.start-2}else{k.replaceSelection("**"+l+"**"),m=n.start+2}k.setSelection(m,m+l.length)}},{name:"cmdItalic",title:"Italic",icon:"glyphicon glyphicon-italic",callback:function(k){var l,m,n=k.getSelection(),o=k.getContent();l=0==n.length?"emphasized text":n.text;if("*"==o.substr(n.start-1,1)&&"*"==o.substr(n.end,1)){k.setSelection(n.start-1,n.end+1),k.replaceSelection(l),m=n.start-1}else{k.replaceSelection("*"+l+"*"),m=n.start+1}k.setSelection(m,m+l.length)}},{name:"cmdHeading",title:"Heading",icon:"glyphicon glyphicon-font",callback:function(k){var l,m,n,o,p=k.getSelection(),q=k.getContent();l=0==p.length?"heading text":p.text;if(n=4,"### "==q.substr(p.start-n,n)||(n=3,"###"==q.substr(p.start-n,n))){k.setSelection(p.start-n,p.end),k.replaceSelection(l),m=p.start-dl}else{if(o=q.substr(p.start-1,1),o&&"\n"!=o){(k.replaceSelection("\n\n### "+l+"\n"),m=p.start+6)}else{(k.replaceSelection("### "+l+"\n"),m=p.start+4)}}k.setSelection(m,m+l.length)}}]},{name:"groupLink",data:[{name:"cmdUrl",title:"URL/Link",icon:"glyphicon glyphicon-globe",callback:function(k){var l,m,n,o=k.getSelection();k.getContent();l=0==o.length?"enter link description here":o.text,n=prompt("Insert Hyperlink","http://"),null!=n&&(k.replaceSelection("["+l+"]("+n+")"),m=o.start+1,k.setSelection(m,m+l.length))}},{name:"cmdImage",title:"Image",icon:"glyphicon glyphicon-picture",callback:function(k){var l,m,n,o=k.getSelection();k.getContent();l=0==o.length?"enter image description here":o.text,n=prompt("Insert Image Hyperlink","http://");if(null!=n){k.replaceSelection("!["+l+"]("+n+' "enter image title here")'),m=o.start+2,k.setNextTab("enter image title here"),k.setSelection(m,m+l.length)}}}]},{name:"groupMisc",data:[{name:"cmdList",title:"List",icon:"glyphicon glyphicon-list",callback:function(a){var k,l,m=a.getSelection();a.getContent();if(0==m.length){k="list text here",a.replaceSelection("- "+k),l=m.start+2}else{if(m.text.indexOf("\n")<0){k=m.text,a.replaceSelection("- "+k),l=m.start+2}else{var n=[];n=m.text.split("\n"),k=n[0],f.each(n,function(c,d){n[c]="- "+d}),a.replaceSelection("\n\n"+n.join("\n")),l=m.start+4}}a.setSelection(l,l+k.length)}}]},{name:"groupUtil",data:[{name:"cmdPreview",toggle:!0,title:"Preview",btnText:"Preview",btnClass:"btn btn-primary btn-sm",icon:"glyphicon glyphicon-search",callback:function(c){var d=c.$isPreview;0==d?c.showPreview():c.hidePreview()}}]}]],additionalButtons:[],onShow:function(){},onPreview:function(){},onSave:function(){},onBlur:function(){}},f.fn.markdown.Constructor=g,f.fn.markdown.noConflict=function(){return f.fn.markdown=h,this};var i=function(c){var d=c;return d.data("markdown")?void d.data("markdown").showEditor():void d.markdown(d.data())},j=function(a){var k,l=!1,m=f(a.currentTarget);if(!("focusin"!=a.type&&"click"!=a.type||1!=m.length||"object"!=typeof m[0])){k=m[0].activeElement;if(!f(k).data("markdown")){if("undefined"==typeof f(k).parent().parent().parent().attr("class")||f(k).parent().parent().parent().attr("class").indexOf("md-editor")<0){if("undefined"==typeof f(k).parent().parent().attr("class")||f(k).parent().parent().attr("class").indexOf("md-editor")<0){l=!0}}else{l=!1}}if(l){f(document).find(".md-editor").each(function(){var c=f(k).parent();if(f(this).attr("id")!=c.attr("id")){var e;e=f(this).find("textarea").data("markdown"),null==e&&(e=f(this).find('div[data-provider="markdown-preview"]').data("markdown")),e&&e.blur()}})}a.stopPropagation()}};f(document).on("click.markdown.data-api",'[data-provide="markdown-editable"]',function(a){i(f(this)),a.preventDefault()}).on("click",function(b){j(b)}).on("focusin",function(b){j(b)}).ready(function(){f('textarea[data-provide="markdown"]').each(function(){i(f(this))})})}(window.jQuery);