/* SmartAdmin - v1.4.1 - 2014-06-26 */
!function(c){function d(a,e){this.options=this.mergeOptions(e),this.$select=c(a),this.originalOptions=this.$select.clone()[0].options,this.query="",this.searchTimeout=null,this.options.multiple="multiple"==this.$select.attr("multiple"),this.options.onChange=c.proxy(this.options.onChange,this),this.buildContainer(),this.buildButton(),this.buildSelectAll(),this.buildDropdown(),this.buildDropdownOptions(),this.buildFilter(),this.updateButtonText(),this.$select.hide().after(this.$container)}if("undefined"!=typeof ko&&ko.bindingHandlers&&!ko.bindingHandlers.multiselect){ko.bindingHandlers.multiselect={init:function(){},update:function(a,f,g){var h=c(a).data("multiselect");h?g().options&&g().options().length!==h.originalOptions.length&&(h.updateOriginalOptions(),c(a).multiselect("rebuild")):c(a).multiselect(ko.utils.unwrapObservable(f()))}}}d.prototype={defaults:{buttonText:function(a){if(0==a.length){return this.nonSelectedText+' <b class="caret"></b>'}if(a.length>3){return a.length+" "+this.nSelectedText+' <b class="caret"></b>'}var e="";a.each(function(){var f=void 0!==c(this).attr("label")?c(this).attr("label"):c(this).html();e+=f+", "});return e.substr(0,e.length-2)+' <b class="caret"></b>'},buttonTitle:function(a){if(0==a.length){return this.nonSelectedText}var e="";a.each(function(){e+=c(this).text()+", "});return e.substr(0,e.length-2)},onChange:function(){},buttonClass:"btn",dropRight:!1,selectedClass:"active",buttonWidth:"auto",buttonContainer:'<div class="btn-group" />',maxHeight:!1,includeSelectAllOption:!1,selectAllText:" Select all",selectAllValue:"multiselect-all",enableFiltering:!1,enableCaseInsensitiveFiltering:!1,filterPlaceholder:"Search",filterBehavior:"text",preventInputChangeEvent:!1,nonSelectedText:"None selected",nSelectedText:"selected"},templates:{button:'<button type="button" class="multiselect dropdown-toggle" data-toggle="dropdown"></button>',ul:'<ul class="multiselect-container dropdown-menu"></ul>',filter:'<div class="input-group"><span class="input-group-addon"><i class="glyphicon glyphicon-search"></i></span><input class="form-control multiselect-search" type="text"></div>',li:'<li><a href="javascript:void(0);"><label></label></a></li>',liGroup:'<li><label class="multiselect-group"></label></li>'},constructor:d,buildContainer:function(){this.$container=c(this.options.buttonContainer)},buildButton:function(){this.$button=c(this.templates.button).addClass(this.options.buttonClass),this.$select.prop("disabled")?this.disable():this.enable(),this.options.buttonWidth&&this.$button.css({width:this.options.buttonWidth});var a=this.$select.attr("tabindex");a&&this.$button.attr("tabindex",a),this.$container.prepend(this.$button)},buildDropdown:function(){this.$ul=c(this.templates.ul),this.options.dropRight&&this.$ul.addClass("pull-right"),this.options.maxHeight&&this.$ul.css({"max-height":this.options.maxHeight+"px","overflow-y":"auto","overflow-x":"hidden"}),this.$container.append(this.$ul)},buildDropdownOptions:function(){this.$select.children().each(c.proxy(function(a,e){var f=c(e).prop("tagName").toLowerCase();"optgroup"==f?this.createOptgroup(e):"option"==f&&this.createOptionValue(e)},this)),c("li input",this.$ul).on("change",c.proxy(function(a){var i=c(a.target).prop("checked")||!1,j=c(a.target).val()==this.options.selectAllValue;this.options.selectedClass&&(i?c(a.target).parents("li").addClass(this.options.selectedClass):c(a.target).parents("li").removeClass(this.options.selectedClass));var k=c(a.target).val(),l=this.getOptionByValue(k),m=c("option",this.$select).not(l),n=c("input",this.$container).not(c(a.target));j&&n.filter(function(){return c(this).is(":checked")!=i}).trigger("click");if(i){l.prop("selected",!0);if(this.options.multiple){l.prop("selected",!0)}else{this.options.selectedClass&&c(n).parents("li").removeClass(this.options.selectedClass),c(n).prop("checked",!1),m.prop("selected",!1),this.$button.click()}"active"==this.options.selectedClass&&m.parents("a").css("outline","")}else{l.prop("selected",!1)}this.updateButtonText(),this.$select.change(),this.options.onChange(l,i);return this.options.preventInputChangeEvent?!1:void 0},this)),c("li a",this.$ul).on("touchstart click",function(a){a.stopPropagation(),c(a.target).blur()}),this.$container.on("keydown",c.proxy(function(a){if(!c('input[type="text"]',this.$container).is(":focus")){if(9!=a.keyCode&&27!=a.keyCode||!this.$container.hasClass("open")){var g=c(this.$container).find("li:not(.divider):visible a");if(!g.length){return}var h=g.index(g.filter(":focus"));38==a.keyCode&&h>0?h--:40==a.keyCode&&h<g.length-1?h++:~h||(h=0);var i=g.eq(h);if(i.focus(),32==a.keyCode||13==a.keyCode){var j=i.find("input");j.prop("checked",!j.prop("checked")),j.change()}a.stopPropagation(),a.preventDefault()}else{this.$button.click()}}},this))},createOptionValue:function(a){c(a).is(":selected")&&c(a).prop("selected",!0);var i=c(a).attr("label")||c(a).html(),j=c(a).val(),k=this.options.multiple?"checkbox":"radio",l=c(this.templates.li);c("label",l).addClass(k),c("label",l).append('<input type="'+k+'" />');var m=c(a).prop("selected")||!1,n=c("input",l);n.val(j),j==this.options.selectAllValue&&n.parent().parent().addClass("multiselect-all"),c("label",l).append(" "+i),this.$ul.append(l),c(a).is(":disabled")&&n.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"),n.prop("checked",m),m&&this.options.selectedClass&&n.parents("li").addClass(this.options.selectedClass)},createOptgroup:function(a){var e=c(a).prop("label"),f=c(this.templates.liGroup);c("label",f).text(e),this.$ul.append(f),c("option",a).each(c.proxy(function(g,h){this.createOptionValue(h)},this))},buildSelectAll:function(){var b=this.$select[0][0]?this.$select[0][0].value==this.options.selectAllValue:!1;this.options.includeSelectAllOption&&this.options.multiple&&!b&&this.$select.prepend('<option value="'+this.options.selectAllValue+'">'+this.options.selectAllText+"</option>")},buildFilter:function(){if(this.options.enableFiltering||this.options.enableCaseInsensitiveFiltering){var a=Math.max(this.options.enableFiltering,this.options.enableCaseInsensitiveFiltering);this.$select.find("option").length>=a&&(this.$filter=c(this.templates.filter),c("input",this.$filter).attr("placeholder",this.options.filterPlaceholder),this.$ul.prepend(this.$filter),this.$filter.val(this.query).on("click",function(b){b.stopPropagation()}).on("keydown",c.proxy(function(e){clearTimeout(this.searchTimeout),this.searchTimeout=this.asyncFunction(c.proxy(function(){this.query!=e.target.value&&(this.query=e.target.value,c.each(c("li",this.$ul),c.proxy(function(h,i){var j=c("input",i).val();if(j!=this.options.selectAllValue){var k=c("label",i).text(),j=c("input",i).val();if(j&&k&&j!=this.options.selectAllValue){var l=!1,m="";("text"==this.options.filterBehavior||"both"==this.options.filterBehavior)&&(m=k),("value"==this.options.filterBehavior||"both"==this.options.filterBehavior)&&(m=j),this.options.enableCaseInsensitiveFiltering&&m.toLowerCase().indexOf(this.query.toLowerCase())>-1?l=!0:m.indexOf(this.query)>-1&&(l=!0),l?c(i).show():c(i).hide()}}},this)))},this),300,this)},this)))}},destroy:function(){this.$container.remove(),this.$select.show()},refresh:function(){c("option",this.$select).each(c.proxy(function(a,e){var f=c("li input",this.$ul).filter(function(){return c(this).val()==c(e).val()});c(e).is(":selected")?(f.prop("checked",!0),this.options.selectedClass&&f.parents("li").addClass(this.options.selectedClass)):(f.prop("checked",!1),this.options.selectedClass&&f.parents("li").removeClass(this.options.selectedClass)),c(e).is(":disabled")?f.attr("disabled","disabled").prop("disabled",!0).parents("li").addClass("disabled"):f.prop("disabled",!1).parents("li").removeClass("disabled")},this)),this.updateButtonText()},select:function(a){a&&!c.isArray(a)&&(a=[a]);for(var g=0;g<a.length;g++){var h=a[g],i=this.getOptionByValue(h),j=this.getInputByValue(h);this.options.selectedClass&&j.parents("li").addClass(this.options.selectedClass),j.prop("checked",!0),i.prop("selected",!0),this.options.onChange(i,!0)}this.updateButtonText()},deselect:function(a){a&&!c.isArray(a)&&(a=[a]);for(var g=0;g<a.length;g++){var h=a[g],i=this.getOptionByValue(h),j=this.getInputByValue(h);this.options.selectedClass&&j.parents("li").removeClass(this.options.selectedClass),j.prop("checked",!1),i.prop("selected",!1),this.options.onChange(i,!1)}this.updateButtonText()},rebuild:function(){this.$ul.html(""),c('option[value="'+this.options.selectAllValue+'"]',this.$select).remove(),this.options.multiple="multiple"==this.$select.attr("multiple"),this.buildSelectAll(),this.buildDropdownOptions(),this.updateButtonText(),this.buildFilter()},dataprovider:function(e){var f="";e.forEach(function(b){f+='<option value="'+b.value+'">'+b.label+"</option>"}),this.$select.html(f),this.rebuild()},enable:function(){this.$select.prop("disabled",!1),this.$button.prop("disabled",!1).removeClass("disabled")},disable:function(){this.$select.prop("disabled",!0),this.$button.prop("disabled",!0).addClass("disabled")},setOptions:function(b){this.options=this.mergeOptions(b)},mergeOptions:function(a){return c.extend({},this.defaults,a)},updateButtonText:function(){var a=this.getSelected();c("button",this.$container).html(this.options.buttonText(a,this.$select)),c("button",this.$container).attr("title",this.options.buttonTitle(a,this.$select))},getSelected:function(){return c('option[value!="'+this.options.selectAllValue+'"]:selected',this.$select).filter(function(){return c(this).prop("selected")})},getOptionByValue:function(a){return c("option",this.$select).filter(function(){return c(this).val()==a})},getInputByValue:function(a){return c("li input",this.$ul).filter(function(){return c(this).val()==a})},updateOriginalOptions:function(){this.originalOptions=this.$select.clone()[0].options},asyncFunction:function(e,f,g){var h=Array.prototype.slice.call(arguments,3);return setTimeout(function(){e.apply(g||window,h)},f)}},c.fn.multiselect=function(a,b){return this.each(function(){var g=c(this).data("multiselect"),h="object"==typeof a&&a;g||c(this).data("multiselect",g=new d(this,h)),"string"==typeof a&&g[a](b)})},c.fn.multiselect.Constructor=d,c(function(){c("select[data-role=multiselect]").multiselect()})}(window.jQuery);