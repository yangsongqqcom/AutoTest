/*
** Unobtrusive Ajax support library for jQuery
** Copyright (C) Microsoft Corporation. All rights reserved.
*/
(function(a){var e="unobtrusiveAjaxClick",f="unobtrusiveValidation";function g(k,j){var l=window,m=(k||"").split(".");while(l&&m.length){l=l[m.shift()]}if(typeof(l)==="function"){return l}j.push(k);return Function.constructor.apply(null,j)}function h(j){return j==="GET"||j==="POST"}function b(k,j){if(!h(j)){k.setRequestHeader("X-HTTP-Method-Override",j)}}function c(l,k,j){var m;if(j.indexOf("application/x-javascript")!==-1){return}m=(l.getAttribute("data-ajax-mode")||"").toUpperCase();a(l.getAttribute("data-ajax-update")).each(function(n,p){var o;switch(m){case"BEFORE":o=p.firstChild;a("<div />").html(k).contents().each(function(){p.insertBefore(this,o)});break;case"AFTER":a("<div />").html(k).contents().each(function(){p.appendChild(this)});break;default:a(p).html(k);break}})}function d(m,s){var k,q,r,l;k=m.getAttribute("data-ajax-confirm");if(k&&!window.confirm(k)){return}q=a(m.getAttribute("data-ajax-loading"));l=m.getAttribute("data-ajax-loading-duration")||0;var o;a.extend(s,{type:m.getAttribute("data-ajax-method")||undefined,url:m.getAttribute("data-ajax-url")||undefined,beforeSend:function(v){var u;b(v,r);u=g(m.getAttribute("data-ajax-begin"),["xhr"]).apply(this,arguments);if(u===false){o.hide(l)}return u},complete:function(){o.setProgress(1,1);o.setToolText("已处理完成");setTimeout(function(){o.hide()},1000);g(m.getAttribute("data-ajax-complete"),["xhr","status"]).apply(this,arguments)},success:function(u,v,w){c(m,u,w.getResponseHeader("Content-Type")||"text/html");g(m.getAttribute("data-ajax-success"),["data","status","xhr"]).apply(this,arguments)},error:g(m.getAttribute("data-ajax-failure"),["xhr","status","error"])});s.data.push({name:"X-Requested-With",value:"XMLHttpRequest"});r=s.type.toUpperCase();if(!h(r)){s.type="POST";s.data.push({name:"X-HTTP-Method-Override",value:r})}var j=a(m).find(":file:not(:disabled)");if(r=="POST"&&j.length>0&&(a(m)[0].enctype||"").toLowerCase()=="multipart/form-data"){o=new formLoading({toolType:"progress"});var t=new XMLHttpRequest();t.onreadystatechange=function(){switch(t.readyState){case 1:o.show("正在开始请求...");break;case 2:break;case 3:o.setToolText("正在等待服务器响应...");break;case 4:var v=false;var y="";var w=t.responseText;if(t.status==200){v=true;y="success";try{w=a.parseJSON(w)}catch(u){}}else{if(t.status==204){v=true;y="nocontent"}else{if(t.status==304){v=true;y="notmodified"}else{v=false;y=t.statusText;if(!y){y="error"}}}}var x="";if(v){s.success.apply(s,[w,y,t])}else{s.error.apply(s,[t,t.statusText,y])}s.complete.apply(s,[t,y]);break}};t.upload.addEventListener("progress",function(u){o.setProgress(u.loaded,u.total);o.setToolText("正在上传...")},false);if(s.beforeSend.apply(s,[t])===false){t.abort();t=null;return}t.open(s.type,s.url,true);var n=new FormData();for(var p=0;p<s.data.length;++p){n.append(s.data[p].name,s.data[p].value||"")}j.each(function(){var u=a(this)[0];if(u.multiple){for(var v=0;v<u.files.length;++v){n.append(u.name,u.files[v]||"")}}else{n.append(u.name,u.files[0]||"")}});t.send(n)}else{o=new formLoading();o.show("正在提交数据...");a.ajax(s)}}function i(j){var k=a(j).data(f);return !k||!k.validate||k.validate()}a(document).on("click","a[data-ajax=true]",function(j){j.preventDefault();d(this,{url:this.href,type:"GET",data:[]})});a(document).on("click","form[data-ajax=true] input[type=image]",function(k){var m=k.target.name,j=a(k.target),l=j.parents("form")[0],n=j.offset();a(l).data(e,[{name:m+".x",value:Math.round(k.pageX-n.left)},{name:m+".y",value:Math.round(k.pageY-n.top)}]);setTimeout(function(){a(l).removeData(e)},0)});a(document).on("click","form[data-ajax=true] :submit",function(j){var l=j.target.name,k=a(j.target).parents("form")[0];a(k).data(e,l?[{name:l,value:j.target.value}]:[]);setTimeout(function(){a(k).removeData(e)},0)});a(document).on("submit","form[data-ajax=true]",function(k){var j=a(this).data(e)||[];k.preventDefault();if(!i(this)){return}d(this,{url:this.action,type:this.method||"GET",data:j.concat(a(this).serializeArray())})})}(jQuery));